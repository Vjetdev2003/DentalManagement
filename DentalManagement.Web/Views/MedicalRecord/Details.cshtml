@using DentalManagement.DomainModels
@model DentalManagement.Web.Models.MedicalRecordDetailsModel
@{
    ViewBag.Title = "Chi tiết hồ sơ y tế";
}
<div class="box box-primary">
    <div class="box-header text-right">
        <div class="btn-group">
            @(ViewBag.IsEmployee)
            
                <div class="btn-group">
                @if (!ViewBag.IsFinish)
                {
                    <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">
                        Xử lý hồ sơ <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        @switch(Model.MedicalRecord.Status)
                        {
                            case Constants_MedicalRecord.UNPROCESS:
                                <li>
                                    <a href="~/MedicalRecord/Confirm/@Model.MedicalRecord.MedicalRecordId" onclick="return confirm('Xác nhận xử lý hồ sơ này?')">Xử lý hồ sơ </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="~/MedicalRecord/Cancel/@Model.MedicalRecord.MedicalRecordId" onclick="return confirm('Huỷ hồ sơ')">Huỷ hồ sơ</a>
                                </li>
                                break;
                            case Constants_MedicalRecord.PENDING:
                                <li>
                                    <a href="~/MedicalRecord/Report/@Model.MedicalRecord.MedicalRecordId" method="post" class="btn btn-modal">Báo cáo sau điều trị </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="~/MedicalRecord/Cancel/@Model.MedicalRecord.MedicalRecordId" onclick="return confirm('Huỷ hồ sơ')">Huỷ hồ sơ</a>
                                </li>
                                break;
                            case Constants_MedicalRecord.COMPLETE:
                                <li>
                                    <a href="~/MedicalRecord/Finish/@Model.MedicalRecord.MedicalRecordId" onclick="return confirm('Xác nhận hoàn tất hóa đơn này?')">Xác nhận hồ sơ</a>
                                </li>

                                break;
                            }
                        </ul>
                      }
                @if (ViewBag.IsDelete)
                {
                    <a href="~/MedicalRecord/Delete/@Model.MedicalRecord.MedicalRecordId" class="btn btn-sm btn-danger" onclick="return confirm('Có chắc chắn muốn xóa hồ sơ này không?')">
                        <i class="fa fa-trash"></i> Xóa hồ sơ
                    </a>
                }
                <a href="~/MedicalRecord" class="btn btn-sm btn-info">Quay lại</a>
            </div>
        </div>
    </div>

    <!-- Remaining HTML content like details of the medical record -->
    <div class="box-body">
        <div class="form-group">
            <label class="col-sm-2">Mã hồ sơ</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.MedicalRecordId</p>
            </div>
            <label class="col-sm-2">Ngày tạo hồ sơ</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.DateCreated.ToString("dd/MM/yyyy")</p>
            </div>
            <label class="col-sm-2">Trạng thái hồ sơ</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.DescriptionStatus</p>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2">Bệnh nhân</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.Patient?.PatientName</p>
            </div>
            <label class="col-sm-2">Nha sĩ</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.Dentist?.DentistName</p>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2">Dịch vụ</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.Service?.ServiceName</p>
            </div>
            <label class="col-sm-2">Chẩn đoán</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.Diagnosis</p>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2">Phương pháp điều trị</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.Treatment</p>
            </div>
            <label class="col-sm-2">Kết quả điều trị</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.TreatmentOutcome</p>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2">Ngày điều trị</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.DateOfTreatment?.ToString("dd/MM/yyyy")</p>
            </div>
            <label class="col-sm-2">Ngày hẹn tiếp theo</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.NextAppointmentDate?.ToString("dd/MM/yyyy")</p>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2">Triệu chứng</label>
            <div class="col-sm-4">
                <p class="form-control">@Model.MedicalRecord.Symptoms</p>
            </div>
        </div>
    </div>
</div>
<div id="dialogModal" class="modal fade" role="dialog">
</div>
@section scripts {
    <script>
        $(document).ready(function () {
            $(".btn-modal").click(function (e) {
                e.preventDefault();
                var link = $(this).prop("href");
                $.ajax({
                    url: link,
                    type: "GET",
                    error: function () {
                        alert("Your request is not valid!");
                    },
                    success: function (data) {
                        $("#dialogModal").empty();
                        $("#dialogModal").html(data);
                        $("#dialogModal").modal();
                    }
                });
            });
        })
    </script>
}