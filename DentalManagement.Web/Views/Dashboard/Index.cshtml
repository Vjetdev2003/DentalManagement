@model DentalManagement.DomainModels.DashboardStatistics

@{
    ViewBag.Title = "Dashboard Chart Example";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="/js/signalr/dist/browser/signalr.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.0/signalr.min.js"></script>

<!-- Chat.js -->
<script src="/js/chat.js?v=4.0"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div class="row">
    <!-- Column for Payment Method Distribution -->
    <div class="col-xs-6">
        <div class="box box-danger">
            <div class="box-header with-border">
                <h3 class="box-title">Thanh toán</h3>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                </div>
            </div>
            <div class="box-body">
                <canvas id="paymentChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Column for Appointment Status -->
    <div class="col-md-6">
        <div class="box box-success">
            <div class="box-header with-border">
                <h3 class="box-title">Appointment Status</h3>
            </div>
            <div class="box-body">
                <div class="chart">
                    <canvas id="appointmentsChart" style="height:230px; width:100%;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bar Chart for Total Revenue -->
<div class="row">
    <div class="col-md-6">
        <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">Total Revenue</h3>
        </div>
        <div class="box-body">
            <div class="chart">
                <canvas id="revenueChart" style="height:230px;"></canvas>
            </div>
        </div>
       </div>
    </div>

    <div class="col-md-6">
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Các dịch vụ từ lịch hẹn</h3>
            </div>
            <div class="box-body">
                <canvas id="serviceChart" style="height: 300px;"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Total Patients Display -->
<div class="box box-info">
    <div class="box-header with-border">
        <h3 class="box-title">Total Patients</h3>
    </div>
    <div class="box-body">
        <h4>@Model.TotalPatients</h4>
    </div>
</div>

<!-- Include required scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    $(function () {
        // Lấy dữ liệu từ model truyền vào view
        var cashPayments = @Model.CashPayments;
        var bankingPayments = @Model.BankingPayments;
        var completedAppointments = @Model.CompletedAppointments;
        var canceledAppointments = @Model.CanceledAppointments;
        var totalRevenue = @Model.TotalRevenue;
        var serviceLabels = @Html.Raw(Json.Serialize(Model.ServiceStatistics.Select(s => s.ServiceName).ToArray()));
        var appointmentCounts = @Html.Raw(Json.Serialize(Model.ServiceStatistics.Select(s => s.AppointmentCount).ToArray()));

        // Payment method distribution for Pie Chart
        var paymentData = {
            labels: ['Tiên Mặt','Chuyển Khoản'],
            datasets: [{
                data: [cashPayments, bankingPayments],
                backgroundColor: ['#00a65a', '#3c8dbc'],
                hoverBackgroundColor: ['#00a65a', '#3c8dbc']
            }]
        };

        var pieOptions = {
            responsive: true,
            maintainAspectRatio: true,
            animation: {
                animateRotate: true,
                animateScale: false
            },
            plugins: {
                legend: { display: true, position: 'top' }
            }
        };

        // Create the Pie Chart for Payment Method Distribution
        var paymentChartCanvas = document.getElementById('paymentChart').getContext('2d');
        new Chart(paymentChartCanvas, {
            type: 'doughnut',
            data: paymentData,
            options: pieOptions
        });

        // Appointment Status Bar Chart
        var appointmentData = {
            labels: ['Completed', 'Canceled'],
            datasets: [{
                label: 'Appointments',
                backgroundColor: ['#00a65a', '#f56954'],
                data: [completedAppointments, canceledAppointments]
            }]
        };

        var barOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: true },
                tooltip: { enabled: true }
            },
            scales: {
                x: { beginAtZero: true },
                y: { beginAtZero: true }
            }
        };

        // Create the Bar Chart for Appointment Status
        var appointmentChartCanvas = $('#appointmentsChart').get(0).getContext('2d');
        new Chart(appointmentChartCanvas, {
            type: 'bar',
            data: appointmentData,
            options: barOptions
        });

        // Total Revenue Bar Chart
        var revenueData = {
            labels: ['Total Revenue'],
            datasets: [{
                label: 'Revenue',
                backgroundColor: ['#00c0ef'],
                data: [totalRevenue]
            }]
        };

        var revenueOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: true },
                tooltip: { enabled: true }
            },
            scales: {
                x: { beginAtZero: true },
                y: { beginAtZero: true }
            }
        };

        // Create the Bar Chart for Total Revenue
        var revenueChartCanvas = $('#revenueChart').get(0).getContext('2d');
        new Chart(revenueChartCanvas, {
            type: 'bar',
            data: revenueData,
            options: revenueOptions
        });

        // Service Statistics Bar Chart
        var serviceData = {
            labels: serviceLabels,
            datasets: [{
                label: 'Appointments by Service',
                backgroundColor: '#00a65a',
                data: appointmentCounts
            }]
        };

        var serviceOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: true },
                tooltip: { enabled: true }
            },
            scales: {
                x: { beginAtZero: true },
                y: { beginAtZero: true }
            }
        };

        // Create the Bar Chart for Service Statistics
        var serviceChartCanvas = $('#serviceChart').get(0).getContext('2d');
        new Chart(serviceChartCanvas, {
            type: 'bar',
            data: serviceData,
            options: serviceOptions
        });
    });
</script>
